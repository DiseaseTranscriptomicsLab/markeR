% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/calculateDE.R
\name{calculateDE}
\alias{calculateDE}
\title{Calculate Differential Gene Expression Statistics using limma}
\usage{
calculateDE(
  data,
  metadata = NULL,
  variables = NULL,
  lmexpression = NULL,
  modelmat = NULL,
  contrasts = NULL
)
}
\arguments{
\item{data}{A numeric matrix of gene expression values with genes as rows and samples as columns. Row names must correspond to gene identifiers.
Data should \emph{not} be transformed (i.e., not log2 transformed).}

\item{metadata}{A data frame containing sample metadata used to build the design matrix (unless a design is provided directly).}

\item{variables}{A character vector specifying the variable(s) from \code{metadata} to use in the default linear model.
Ignored if \code{lmexpression} or \code{design} is provided.}

\item{lmexpression}{(Optional) A model formula (e.g., \code{~0 + X} or \code{~X}) provided by the user to build the design matrix.
If provided, this formula is used instead of constructing one from \code{variables}.}

\item{modelmat}{(Optional) A user-supplied design matrix. If provided, this design is used directly and \code{lmexpression} and \code{variables}
are ignored. The order of samples in the design matrix should match the order in data.}

\item{contrasts}{A character vector specifying contrasts to be applied (e.g., \code{c("A-B")}).
If multiple contrasts are provided, the function returns a list of DE results (one per contrast). \emph{Required} if
\code{lmexpression} is NULL, optional otherwise. If not provided, the average expression profile of each
condition will be returned instead of differential gene expression.}
}
\value{
A list of data-frames of differential expression statistics
}
\description{
This function computes differential gene expression statistics for each gene using a linear model via the limma package.
Users may supply a custom design matrix directly via the \code{design} argument, or specify a model formula (\code{lmexpression})
(e.g., \code{~0 + X} or \code{~X}) or variables from \code{metadata} to build the design matrix. When contrasts are supplied,
they are applied using \code{limma::makeContrasts} and \code{limma::contrasts.fit}. Alternatively, when using \code{lmexpression} or a supplied
\code{design}, specific coefficient indices may be provided via \code{coefs} to extract the corresponding gene-level statistics.
}
\details{
The function fits a linear model with \code{limma::lmFit} and applies empirical Bayes moderation with \code{limma::eBayes}. Depending on the input:
\itemize{
\item If a design matrix is provided via \code{design}, that design is used directly.
\item If \code{lmexpression} is provided (and no design is supplied), a design matrix is built using that formula.
\item Otherwise, a design matrix is constructed using the \code{variables} argument (with no intercept).
\item If contrasts are provided, they are applied using \code{limma::makeContrasts} and \code{limma::contrasts.fit}.
\item If no contrasts are provided, the function returns all possible coefficients fitted in the linear model.
}
}
\examples{
\dontrun{
  # Create example data:
  data <- matrix(rnorm(1000), nrow = 100, ncol = 10)
  rownames(data) <- paste0("gene", 1:100)
  colnames(data) <- paste0("sample", 1:10)
  metadata <- data.frame(sample = colnames(data), X = rep(c("A", "B"), each = 5))

  # Example 1: Build design matrix from variables with a contrast:
  de_res <- calculateDE(data, metadata, variables = "X", contrasts = "A-B")

  # Example 2: Use a custom model formula:
  de_res2 <- calculateDE(data, metadata, variables = "X", lmexpression = "~X", coefs = c(2,3))

  # Example 3: Supply a custom design matrix directly:
  design <- model.matrix(~0 + X, data = metadata)
  de_res3 <- calculateDE(data, metadata, variables = "X", design = design, contrasts = "A-B")
}

}
